{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'GPTrivia/css/buzzer.css' %}">
{% endblock %}

{% block extra_meta %}
    <script>
        const socket = new WebSocket(
            (window.location.protocol === 'https:' ? 'wss://' : 'ws://') + window.location.host + '/ws/button/'
        );

        // Listen for messages from the WebSocket
        socket.onmessage = function (e) {
            const data = JSON.parse(e.data);

            // Update the last-press text
            const lastPressElement = document.getElementById('last-press');
            lastPressElement.textContent = data.username;

            // Select the button and add the "pressed" class
            const button = document.querySelector('button');
            if (button) {
                button.classList.add('pressed'); // Change the button's color

                // Remove the "pressed" class after 2 seconds
                setTimeout(() => button.classList.remove('pressed'), 2000);
            }
        };

        function sendPress() {
            const username = document.getElementById('username').value;

            if (username) {
                // Send data to WebSocket
                socket.send(JSON.stringify({ username: username }));
            }
        }
    </script>
{% endblock %}

{% block content %}
    <body>
        <h1>Press the Button!</h1>
        <label for="username">Your Name:</label>
        <input type="text" id="username" placeholder="Enter your name" />
        <button onclick="sendPress()">Press Me!</button>

        <h3>Last person to press the button:</h3>
        <p id="last-press">No one yet</p>
    </body>
    </html>
{% endblock %}