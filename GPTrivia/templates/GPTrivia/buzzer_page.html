{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'GPTrivia/css/buzzer.css' %}">
{% endblock %}

{% block extra_meta %}
    <script>
        const socket = new WebSocket(
            (window.location.protocol === 'https:' ? 'wss://' : 'ws://') + window.location.host + '/ws/button/'
        );

        socket.onmessage = function (e) {
            const data = JSON.parse(e.data);

            // Update the last-press text
            const lastPressElement = document.getElementById('last-press');
            lastPressElement.textContent = data.username;

            // Attempt to select the button
            const button = document.getElementById('action-button'); // Select the button by ID
            console.log("Selected button:", button);

            if (button) {
                // Add the "pressed" class and log the action
                button.classList.add('pressed');
                console.log("'pressed' class added to the button.");

                // Remove the "pressed" class after 2 seconds
                setTimeout(() => {
                    button.classList.remove('pressed');
                    console.log("'pressed' class removed from the button.");
                }, 2000);
            } else {
                console.error("Button not found on the page!");
            }
        };

        function sendPress() {
            const username = document.getElementById('username').value;

            if (username) {
                // Send data to WebSocket
                socket.send(JSON.stringify({ username: username }));
            }
        }
    </script>
{% endblock %}

{% block content %}
    <body>
        <h1>Press the Button!</h1>
        <label for="username">Your Name:</label>
        <input type="text" id="username" placeholder="Enter your name" />
        <button id="action-button" onclick="sendPress()">Press Me!</button>
        <h3>Last person to press the button:</h3>
        <p id="last-press">No one yet</p>
    </body>
    </html>
{% endblock %}